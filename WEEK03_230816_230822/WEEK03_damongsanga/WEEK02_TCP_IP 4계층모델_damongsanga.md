## 2.2 TCP/IP 4계층 모델

인터넷 프로토콜 스위트: 인터넷에서 컴퓨터들이 서로 정보를 주고 받는데 쓰이는 프로토콜의 집합

<b>TCP/IP vs OSI 7 Layer 차이</b>
OSI 계층은 애플리케이션 계층을 3개로 쪼개고 링크 계층을 데이터링크 & 물리 계층으로 나눠서 표현

### 2.2.1 계층 구조

### 1.**링크 계층 / 네트워크 접근 계층 (1계층 / OSI 2계층)**

- 특징 : 하나의 같은 네트워크 대역, 즉 LAN 내역에 존재하는 여러 장비들 간의 데이터 전달, 오류제어, 흐름제어
  <i>(다른 네트워크와 통신할 때는 항상 3계층 프로토콜의 도움 필요)</i>
  <br/>
- 주요 프로토콜 : Ethernet
  <br/>
- 핵심 단위 : Ethernet Frame(프레임 OSI 2L) Bit(비트 - OSI 1L)
  <br/>

##### 유선 LAN

: by IEEE 802.3 프로토콜 & 전이중화 통신

- **전이중화 통신** : **양쪽 장치가 동시에 송수신할 수 있는 방식.** 송신로와 수신로로 나눠서 데이터를 주고 받음. 현대의 고속 이더넷은 이 방식을 기반으로 통신중
- **CSMA/CD (현재 사용 X)** : 과거 유선 Ethernet LAN에서 사용하는 프로토콜에서 반이중화 통신 오류 방지를 위해, **하나로 데이터를 보낸 이후 충돌이 발생하면 일정 시간 후 재전송하는 방식.** 이는 수신과 송신을 한 경로로 했을 때에 충돌을 대비하기 위한 방법.
  프레임이 목적지에 도착할 시간 이전에 다른 프레임의 비트가 발견되면 충돌이 일어난 것으로 판단

유선 LAN 케이블

- 트위스트 페어 케이블 (TP 케이블)
  - 여덟개의 구리선을 두 개씩 꼬아서 묶은 케이블
  - UTP : 구리선을 실드 처리 X, 가장 흔하게 보이는 LAN 케이블
  - STP : 구리선을 실드 처리
- 광섬유 케이블
  - 광반사를 이용하여 100Gbps의 데이터 전송.
  - 코어 : 굴절률 높은 부분 / 클래딩 : 굴절률 낮은 부분

##### 무선 LAN

: by IEEE 802.11 프로토콜 & 반이중화 통신

- **반이중화 통신** : 양쪽 장치가 통신은 가능하나 동시에 통신할 수 없음. **한 번에 한 방향만 통신할 수 있는 방식.** 하나의 데이터를 받기까지 전송이 제한되며 동시의 둘 이상의 장치가 전송 (Random Access, 임의접근 )하면 충돌 발생하여 메시지 손실 or 왜곡 발생 가능하여 **충돌 방지 시스템 필요**
- **CSMA/CA** : 반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 캐리어 감지 등 사전에 가능한 충돌을 방지
  1. 데이터 송신 전 무선 매체 확인
  2. 캐리어 감지 : 회선이 비어있는지 판단
  3. **IFS(Inter Frame Space)** : **랜덤한 시간동안 기다리며 무선 매체가 사용중이면 점차 그 간격을 늘려가며 기다림.** 이는 채널을 감지했을때 휴지상태인 것처럼 보일지라도 멀리 떨어진 지국이 이미 전송을 시작했을지 모르기 때문
  4. 이후 데이터 송신

##### 무선 LAN 주파수 및 공유기술

- 2.4GHz
  - 장애물에 강한 특성을 가지고 있음
  - 전자레인지, 무선 등 전파 간섭이 빈번
- **5GHz**
  - 사용할 수 있는 채널 수도 많고 동시에 사용 가능
  - **보통은 이를 이용하는 것이 좋음**
- WIFI
  - 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
  - **AP (Access Point, 공유기)로 유선 LAN 신호를 무선 LAN 신호로 바꿔주어** 범위 내에서 무선 인터넷을 사용할 수 있게 함
  - 이외에 지그비, 블루투스 등의 기술이 있음
- BSS (Basic Server Set)
  - 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조
  - 근거리 무선 통신을 제공하고 하나의 AP 만으로 구축하여 **사용자는 다른 곳으로 이동하면서 네트워크 접속 불가능**
- ESS (Extended Server Set)
  - 하나 이상의 연결된 BSS 그룹
  - 장거리 무선 통신을 제공하며 BSS보다 더 많은 가용성과 이동성 지원
  - **사용자는 다른 장소로 이동하면서 중단없이 네트워크 계속 사용 가능**

##### 이더넷 프레임

- Destination Address (6 byte) : 목적지 MAC 주소
- Source Address (6 byte) : 출발지 MAC 주소
- Ethernet Type (2 byte) : 페이로드 안의 **상위계층 프로토콜**이 어떤건지 알려줌
  **_: IPv4 (0x0800), ARP(0x0806)_**
- Payload : 전달받은 Data
- CRC : 에러 확인 비트

##### MAC 주소

NIC라는 HW에 입력되어있는 물리 주소(식별자), 다른 네트워크 내 통신 때 필요
6 Byte(48 bit)로 구성

#### IEEE 802 표준

: 근거리 통신망과 도시권 통신말을 관할하는 전기 전자 기술자 협회(IEEE) 표준 규칙들의 계열

1. IEEE802.2 : LAN 표준안에서 LLC(논리적 연결 제어) 하부 계층을 정의하는 부분
2. **IEEE 802.3 : LAN 표준안에서 MAC계층과 물리 계층을 정의 / CSMA/CD 방식 / 고속 Ethernet**
3. IEEE 802.4 : LAN 표준안에서 MAC계층과 물리 계층을 정의 / 토큰 버스 방식
4. IEEE 802.5 : LAN 표준안에서 MAC계층과 물리 계층을 정의 / 토큰 링 방식 사용
5. **IEEE 805.11 : Wireless LAN / CSMA/CA 방식**
6. IEEE 802.15 : Bluetooth (PAN)

참조 : <https://itstory.tk/entry/CSMA-CSMACD-CSMACA-%EB%9E%80>

---

### 2. **인터넷 계층 (2계층 / OSI 3계층)**

- 특징 : 다른 네트워크 대역의 데이터 전달, 제어 담당 (LAN과 LAN을 연결) 발신에서 착신까지의 패킷이 경로를 제어하는 계층
  <br/>
- 주요 프로토콜 : IP, ARP, ICMP
  - #### IP : 송신 호스트와 수신 호스트가 패킷 교환 네트워크에서 정보를 주고받는 데 사용하는 정보의 규약
  - 기능
    - 지정한 IP 주소(IP Address)에 데이터 전달
    - 패킷(Packet)이라는 통신 단위로 데이터 전달
  - **IP 주소 : 운영체제라는 SW에 의해 관리되는 논리 주소, 같은 네트워크 내 통신 때 필요**
  - **MAC 주소 : NIC라는 HW에 입력되어있는 물리 주소, 다른 네트워크 내 통신 때 필요**
  - #### ARP : 같은 네트워크 대역에서 통신하기 위해 필요한 MAC 주소를 IP 주소를 이용해서 알아오는 프로토콜
    \*\* **Eth & ARP에서 목적지 MAC 주소 어떻게 암? ARP 프로토콜 통신 방법 추가 정리해둘 것**
  - #### ICMP : 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류메세지를 전송받는데 주로 쓰인다
  <br/>
- 핵심 단위 : Packet(패킷)

---

### 3. **전송 계층 (3계층 / OSI 4계층)**

- **클라이언트인 내 프로그램이 서버와 어떻게 데이터를 주고 받는가?**
  <br/>
- 특징 : 전송 계층으로 송신자의 프로세스와 수신자의 프로세스를 연결하는 통신 서비스를 제공
  <br/>
- 주요 프로토콜 : **TCP, UDP**

  - TCP : 전송 제어 프로토콜, 연결 지향 전송 방식 사용, **가상회선 패킷 방식 (각 패킷에서 가상회선 식별자 포함되어 동일한 경로로 이동, 패킷 순서 보장)**

    - 3-Way Handshake : TCP 연결
      1. SYN : 클라이언트는 서버의 클라이언트의 ISN을 담아 SYN을 보냄
      2. SYN + ACK : 서버는 이를 수신하고 서버의 ISN (SYN 과정) & 클라이언트의 ISN+1을 회신함 (ACK 과정)
      3. ACK : 클라이언트는 ISN+1한 값인 승인번호를 담아 ACK를 서버에 회신함
         <i>ISN : 새로운 TCP 연결의 첫번째 패킷에 할당된 임의의 32bit 고유 시퀀스 번호</i>

    \*\* **좀 더 자세히 공부할 필요 있는 파트**
    <br>

    - 4-Way Handshake : TCP 연결 해제 1. FIN : 클라이언트는 FIN으로 설정된 세그먼트를 서버에 보내고 [FIN_WAIT_1] 상태로 응답을 기다림 2. ACK : 서버는 클라이언트에 ACK 승인 세그먼트를 보내고 [CLOSE_WAIT] 상태로 들어가고 클라이언트는 이를 받으면 [FIN_WAIT_2] 상태로 들어감. 3. FIN : 위 이후 일정 시간 뒤에 클라이언트에 FIN 세그먼트 보냄 4. ACK : 클라이언트는 [TIME_WAIT] 상태가 되며 다시 서버로 ACK를 보내서 서버는 [CLOSED] 상태가 됨. 클라이언트는 일정 시간 대기 후 [CLOSED]. => 클라이언트-서버간 자원 연결 해제
      <br> \* 여기서 ACK, SYN 등은 TCP 패킷의 Flag에 있는 정보
      <br>
    - TIME_WAIT?
      - 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태
      - OS마다 조금씩 다를 수 있음 : 윈도우는 4분, 우분투에는 60초로 설정
        <br>
    - Why TIME_WAIT?
      1. **지연 패킷이 발생한 경우를 대비** (데이터 무결성 문제 방지)
      2. **두 장치가 연결이 닫혔는지 확인 위해** (만약 LAST_ACK 상태에서 닫히면 이후 새로운 연결을 할 때 장치는 줄곧 그 상태로 있기 때문에 접속 오류 발생 가능)
         <br>

  - UDP : 사용자 데이터그램 프로토콜, 비연결 지향형, **데이터그램 패킷 교환 방식 (패킷별로 독립적으로 최적의 경로를 선택하여 순서 보장 X)**
    - 서비스의 신뢰성이 낮고, 데이터그램 도착 순서가 바뀌거나, 중복되거나, 심지어 통보 없이 누락되기도
    - 일반적으로 오류의 검사와 수정이 필요 없는 프로그램에서 수행
    - 단순 전송에 사용

  <br>

- 핵심 단위 : **Segment(세그먼트)**
  - MSS == MTU(Packet의 최대 크기, 1500byte) + a
    <br/>

---

### 4. **애플리케이션 계층 (4계층 / OSI 7계층)**

- 특징 : 응용 프로그램이 사용되는 프로토콜 계층으로 웹서비스, 이메일 등 실질적으로 사람들에게 제공하는 계층  
  <br/>

- 주요 프로토콜 : **HTTP, FTP, SSH, SMTP, DNS**
  - HTTP : 인터넷 상에서 클라이언트와 서버가 자원을 주고 받을 때 쓰는 통신 규약
  - HTTP vs HTTPS ? : HTTP는 텍스트 교환이므로, 누군가 네트워크에서 신호를 가로채면 내용이 노출되는 보안 이슈가 존재하며, 이를 공개키 암호화 방식으로 개선한 것이 HTTPS
    [공개키 방식 설명](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Network/%EB%8C%80%EC%B9%AD%ED%82%A4%20%26%20%EA%B3%B5%EA%B0%9C%ED%82%A4.md)
  - FTP : 장치와 장치 간의 파일 전송하는데 사용되는 표준 통신 프로토콜
  - SSH : 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크의 프로토콜
  - SMTP : 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
  - DNS : 도메인 이름과 IP 주소를 매핑해주는 서버 (매우 중요함으로 추후에 추가 공부할 것)
    <br/>
- 핵심 단위 : **Stream(스트림)**
  - 파일의 data
  - 시작은 알지만 끝을 모름
  - 길이가 정해져 있지 않음 (Live Streaming)

### 계층간 데이터 송수신 과정

##### 캡슐화 과정 (상위 계층 -> 하위 계층)

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정

- 세그먼트화 (L4)
- 패킷화 (L3)
- 프레임화 (L2)

##### 비캡슐화 과정 (하위 계층 -> 상위 계층)

하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하여 데이터를 추출하는 과정

---

### 2.2.2 PDU

PDU (Protocol Unit Data) : 네트워크의 어떠한 계층에서 계층으로 데이터가 전달 될 떄의 기본단위

[ curl www.naver.com이란 명령어의 header 값 확인 ]
<https://reqbin.com/curl>

```
Server: NWS
Content-Type: text/html; charset=UTF-8
Cache-Control: no-cache, no-store, must-revalidate
Pragma: no-cache
P3P: CP="CAO DSP CURa ADMa TAIa PSAa OUR LAW STP PHY ONL UNI PUR FIN COM NAV INT DEM STA PRE"
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=63072000; includeSubdomains
Referrer-Policy: unsafe-url
Content-Encoding: gzip
Content-Length: 36234
Date: Fri, 18 Aug 2023 07:09:33 GMT
Connection: keep-alive
Vary: Accept-Encoding
```

참조 링크 : <https://gyoogle.dev/blog/>
