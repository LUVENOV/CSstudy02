# WEEK07_ERD와 정규화 과정

---

# 4.2 ERD와 정규화 과정

---

- ERD(Entity Relationship Diagram)
    - 데이터베이스 구축 시 가장 기초적인 뼈대 역할
    - 릴레이션 간의 관계들 정의
    - 서비스 구축 시 가장 먼저 신경 써야 하는 부분

## 4.2.1 ERD의 중요성

- ERD는 시스템의 요구 사항을 기반으로 작성되며 이를 기반으로 데이터베이스 구축
- 데이터베이스 구축 이후에도 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우 설계도 역할
- 관계형 구조로 표현 가능한 데이터 구성 시 유용하나 비정형 데이터는 충분히 표현 불가

** 비정형 데이터 : 비구조화 데이터로, 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보

## 4.2.2 예제

### 예제 1

- 영업사원은 0 ~ n명 고객 관리
- 고객은 0 ~ n개의 주문 가능
- 주문에는 1 ~ n개의 상품 포함

### 예제 2

- 선수들은 1명의 챔피언 선택
- 챔피언은 1개 이상의 스킬 포함
- 스킬은 1개 이상의 특성 포함

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled.png)

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%201.png)

## 4.2.3 정규화 과정

- 릴레이션 간의 잘못된 종속 관계로 인한 데이터베이스 이상 현상을 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정
- 데이터베이스 이상 현상 : 회원이 한 개의 등급을 가져야 하는데 세 개의 등급을 갖거나 삭제할 때 필요한 데이터가 같이 삭제되고, 데이터를 삽입해야 하는데 하나의 필드 값이 NULL이 되면 안 돼서 삽입하기 어려운 현상
- 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며, 정규화된 정도는 정규형(NF, Normal Form)으로 표현
- 기본 정규형 : 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형
- 고급 정규형 : 제4정규형, 제5정규형

### 정규형 원칙

1. 보다 좋은 구조로 생성
2. 자료의 중복성 감소
3. 독립적 관계 별개의 릴레이션으로 표현
4. 각각의 릴레이션 독립적 표현 가능

### 제1정규형

- 릴레이션의 모든 도메인이 더 이상 분해 불가한 원자 값(atomic value)만으로 구성되야 함
- 릴레이션 속성 값 중 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합 X
    
    → 있다면 제거
    

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%202.png)

ex ) 홍철이란 ID에 있는 {C++ 코딩테스트, 프런트특강}을 두 개로 나눠서 반복 집합 제거

### 제2정규형

- 릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태
    - 부분 함수의 종속성 제거 : 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%203.png)

ex ) 기본키인 {유저ID, 수강명}과 완전 종속된 유저번호 릴레이션과 ‘{유저 ID,수강명}에 따른 성취도’ 릴레이션으로 분리

- **주의점** : 릴레이션 분해 시 동등한 릴레이션으로 분리해야 하며 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 함

### 제3정규형

- 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)을 만족 X

**이행적 함수 종속**

- A → B와 B → C가 존재하면 논리적으로 A → C가 성립하는데, 이 때 집합 C가 집합 A에 이행적으로 함수 종속

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%204.png)

ex ) 테이블 분해 가능

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%205.png)

### 보이스/코드 정규형(BCNF)

- 제 3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태

** 결정자 : 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소, ‘X→Y’일 때 X는 결정자, Y는 종속자

ex ) 요구 사항

- 각 수강명에 대해 한 학생은 오직 한 강사만의 강의만 수강
- 각 강사는 한 수강명만 담당
- 한 수강명은 여러 강사가 담당 가능

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%206.png)

→ {학번, 수강명} 또는 {학번, 강사}가 후보키

→ 새로운 강사가 새로운 수강명을 담당하여 이를 삽입 시 학번이 NULL이 되는 문제 발생

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%207.png)

→ 위 그림과 같은 함수 종속 다이어그램을 가지며, 강사 속성이 결정자이지만 후보키 X

→ 강사 속성 분리 필요

![Untitled](WEEK07_ERD%E1%84%8B%E1%85%AA%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%80%E1%85%B2%E1%84%92%E1%85%AA%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20368a85afb7494d9e815c60796da2ad6a/Untitled%208.png)

→ 강사 속성 분리를 통해 기존 릴레이션이 알맞게 분해

### +@

- 정규형 과정을 거쳐 테이블을 나눈다고 성능이 100% 좋아지는 것 X
    - 테이블을 나누면 어떠한 쿼리는 조인을 해야 하는 경우도 발생하여 오히려 느려질 수 있음
    - 서비스에 따라 정규화 또는 비정규화 과정 진행